{
  "version": 3,
  "sources": ["../../../worker.js"],
  "sourceRoot": "D:\\SASU\\\u5EB7\u83B1\u5FB7\u7F51\u7AD9\\IV-AEGIS\\.wrangler\\tmp\\deploy-w9nSuc",
  "sourcesContent": ["// Cloudflare Workers \u540E\u7AEF\r\nexport default {\r\n  async fetch(request, env) {\r\n    // CORS \u5904\u7406\r\n    const corsHeaders = {\r\n      'Access-Control-Allow-Origin': '*',\r\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\r\n      'Access-Control-Allow-Headers': 'Content-Type',\r\n    };\r\n\r\n    // \u5904\u7406 OPTIONS \u9884\u68C0\u8BF7\u6C42\r\n    if (request.method === 'OPTIONS') {\r\n      return new Response(null, { headers: corsHeaders });\r\n    }\r\n\r\n    const url = new URL(request.url);\r\n    \r\n    // \u5065\u5EB7\u68C0\u67E5\r\n    if (url.pathname === '/health') {\r\n      return new Response(JSON.stringify({\r\n        status: 'healthy',\r\n        timestamp: new Date().toISOString(),\r\n        service: 'iv-aegis-worker'\r\n      }), {\r\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' }\r\n      });\r\n    }\r\n\r\n    // \u8054\u7CFB\u8868\u5355\u63D0\u4EA4\r\n    if (url.pathname === '/api/contact/submit' && request.method === 'POST') {\r\n      try {\r\n        const body = await request.json();\r\n        const { name, email, message } = body;\r\n\r\n        // \u9A8C\u8BC1\u5FC5\u586B\u5B57\u6BB5\r\n        if (!name || !email || !message) {\r\n          return new Response(JSON.stringify({\r\n            success: false,\r\n            message: 'Please provide all required fields: name, email, message'\r\n          }), {\r\n            status: 400,\r\n            headers: { ...corsHeaders, 'Content-Type': 'application/json' }\r\n          });\r\n        }\r\n\r\n        // \u9A8C\u8BC1\u90AE\u7BB1\u683C\u5F0F\r\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n        if (!emailRegex.test(email)) {\r\n          return new Response(JSON.stringify({\r\n            success: false,\r\n            message: 'Please provide a valid email address'\r\n          }), {\r\n            status: 400,\r\n            headers: { ...corsHeaders, 'Content-Type': 'application/json' }\r\n          });\r\n        }\r\n\r\n        // \u83B7\u53D6\u5BA2\u6237\u7AEF IP\r\n        const clientIP = request.headers.get('CF-Connecting-IP') || 'unknown';\r\n        const userAgent = request.headers.get('User-Agent') || 'unknown';\r\n\r\n        // \u4FDD\u5B58\u5230 D1 \u6570\u636E\u5E93\r\n        if (env.DB) {\r\n          await env.DB.prepare(\r\n            'INSERT INTO contacts (name, email, message, ip_address, user_agent) VALUES (?, ?, ?, ?, ?)'\r\n          ).bind(name, email, message, clientIP, userAgent).run();\r\n        }\r\n\r\n        return new Response(JSON.stringify({\r\n          success: true,\r\n          message: 'Thank you for your message! We will get back to you soon.'\r\n        }), {\r\n          status: 201,\r\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' }\r\n        });\r\n\r\n      } catch (error) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          message: 'Failed to save contact information',\r\n          error: error.message\r\n        }), {\r\n          status: 500,\r\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' }\r\n        });\r\n      }\r\n    }\r\n\r\n    // \u83B7\u53D6\u8054\u7CFB\u4FE1\u606F\u5217\u8868\r\n    if (url.pathname === '/api/contact/list' && request.method === 'GET') {\r\n      try {\r\n        if (env.DB) {\r\n          const { results } = await env.DB.prepare(\r\n            'SELECT id, name, email, message, created_at, status FROM contacts ORDER BY created_at DESC LIMIT 100'\r\n          ).all();\r\n\r\n          return new Response(JSON.stringify({\r\n            success: true,\r\n            data: results,\r\n            count: results.length\r\n          }), {\r\n            headers: { ...corsHeaders, 'Content-Type': 'application/json' }\r\n          });\r\n        }\r\n      } catch (error) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          message: 'Failed to fetch contacts'\r\n        }), {\r\n          status: 500,\r\n          headers: { ...corsHeaders, 'Content-Type': 'application/json' }\r\n        });\r\n      }\r\n    }\r\n\r\n    // 404\r\n    return new Response(JSON.stringify({\r\n      success: false,\r\n      message: `Route ${url.pathname} not found`\r\n    }), {\r\n      status: 404,\r\n      headers: { ...corsHeaders, 'Content-Type': 'application/json' }\r\n    });\r\n  }\r\n};\r\n"],
  "mappings": ";AACA,IAAO,iBAAQ;AAAA,EACb,MAAM,MAAM,SAAS,KAAK;AAExB,UAAM,cAAc;AAAA,MAClB,+BAA+B;AAAA,MAC/B,gCAAgC;AAAA,MAChC,gCAAgC;AAAA,IAClC;AAGA,QAAI,QAAQ,WAAW,WAAW;AAChC,aAAO,IAAI,SAAS,MAAM,EAAE,SAAS,YAAY,CAAC;AAAA,IACpD;AAEA,UAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAG/B,QAAI,IAAI,aAAa,WAAW;AAC9B,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,QAAQ;AAAA,QACR,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,SAAS;AAAA,MACX,CAAC,GAAG;AAAA,QACF,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB;AAAA,MAChE,CAAC;AAAA,IACH;AAGA,QAAI,IAAI,aAAa,yBAAyB,QAAQ,WAAW,QAAQ;AACvE,UAAI;AACF,cAAM,OAAO,MAAM,QAAQ,KAAK;AAChC,cAAM,EAAE,MAAM,OAAO,QAAQ,IAAI;AAGjC,YAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,SAAS;AAC/B,iBAAO,IAAI,SAAS,KAAK,UAAU;AAAA,YACjC,SAAS;AAAA,YACT,SAAS;AAAA,UACX,CAAC,GAAG;AAAA,YACF,QAAQ;AAAA,YACR,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB;AAAA,UAChE,CAAC;AAAA,QACH;AAGA,cAAM,aAAa;AACnB,YAAI,CAAC,WAAW,KAAK,KAAK,GAAG;AAC3B,iBAAO,IAAI,SAAS,KAAK,UAAU;AAAA,YACjC,SAAS;AAAA,YACT,SAAS;AAAA,UACX,CAAC,GAAG;AAAA,YACF,QAAQ;AAAA,YACR,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB;AAAA,UAChE,CAAC;AAAA,QACH;AAGA,cAAM,WAAW,QAAQ,QAAQ,IAAI,kBAAkB,KAAK;AAC5D,cAAM,YAAY,QAAQ,QAAQ,IAAI,YAAY,KAAK;AAGvD,YAAI,IAAI,IAAI;AACV,gBAAM,IAAI,GAAG;AAAA,YACX;AAAA,UACF,EAAE,KAAK,MAAM,OAAO,SAAS,UAAU,SAAS,EAAE,IAAI;AAAA,QACxD;AAEA,eAAO,IAAI,SAAS,KAAK,UAAU;AAAA,UACjC,SAAS;AAAA,UACT,SAAS;AAAA,QACX,CAAC,GAAG;AAAA,UACF,QAAQ;AAAA,UACR,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB;AAAA,QAChE,CAAC;AAAA,MAEH,SAAS,OAAO;AACd,eAAO,IAAI,SAAS,KAAK,UAAU;AAAA,UACjC,SAAS;AAAA,UACT,SAAS;AAAA,UACT,OAAO,MAAM;AAAA,QACf,CAAC,GAAG;AAAA,UACF,QAAQ;AAAA,UACR,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB;AAAA,QAChE,CAAC;AAAA,MACH;AAAA,IACF;AAGA,QAAI,IAAI,aAAa,uBAAuB,QAAQ,WAAW,OAAO;AACpE,UAAI;AACF,YAAI,IAAI,IAAI;AACV,gBAAM,EAAE,QAAQ,IAAI,MAAM,IAAI,GAAG;AAAA,YAC/B;AAAA,UACF,EAAE,IAAI;AAEN,iBAAO,IAAI,SAAS,KAAK,UAAU;AAAA,YACjC,SAAS;AAAA,YACT,MAAM;AAAA,YACN,OAAO,QAAQ;AAAA,UACjB,CAAC,GAAG;AAAA,YACF,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB;AAAA,UAChE,CAAC;AAAA,QACH;AAAA,MACF,SAAS,OAAO;AACd,eAAO,IAAI,SAAS,KAAK,UAAU;AAAA,UACjC,SAAS;AAAA,UACT,SAAS;AAAA,QACX,CAAC,GAAG;AAAA,UACF,QAAQ;AAAA,UACR,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB;AAAA,QAChE,CAAC;AAAA,MACH;AAAA,IACF;AAGA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,SAAS,SAAS,IAAI,QAAQ;AAAA,IAChC,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB;AAAA,IAChE,CAAC;AAAA,EACH;AACF;",
  "names": []
}
